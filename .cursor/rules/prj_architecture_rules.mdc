---
alwaysApply: true
---

# Learn Fast with AI Project Architecture

## ğŸ“š Knowledge

### Project Architecture: Clean Architecture
The project follows **Clean Architecture** with 5 layers:

```
src/
â”œâ”€â”€ domain/           # Core business rules (independent)
â”œâ”€â”€ application/      # Use cases and orchestration
â”œâ”€â”€ infrastructure/   # External adapters (DB, AI, etc.)
â”œâ”€â”€ presentation/     # Request/response handling (actions, handlers)
â””â”€â”€ app/             # Next.js routing (thin adapters)
```

**Layer Dependency Flow (CRITICAL):**
```
Domain â† Application â† Infrastructure
Domain â† Application â† Presentation
Domain â† Application â† App
```

**Allowed:**
- âœ… Application uses Domain interfaces
- âœ… Infrastructure implements Domain interfaces
- âœ… Presentation uses Application use cases
- âœ… App uses Presentation actions/handlers

**Forbidden:**
- âŒ Domain must NOT import from any other layer
- âŒ Domain must NOT know about infrastructure
- âŒ Application must NOT know about infrastructure details
- âŒ Presentation must NOT access Infrastructure directly

### Layer Responsibilities

| Layer | Contains | Examples |
|-------|----------|----------|
| **Domain** | Business entities, interfaces | `User.ts`, `IUserRepository.ts` |
| **Application** | Use cases, DTOs | `CreateUserUseCase.ts`, `FlashcardDTO.ts` |
| **Infrastructure** | Repository implementations, AI services, DB | `UserRepository.ts`, `GeminiAIModel.ts` |
| **Presentation** | Server actions, handlers | `actions.ts`, `UserHandler.ts` |
| **App** | Next.js routes, pages | `route.ts`, `page.tsx` |

### Code Placement by Type

| Type | Location | Example |
|------|----------|---------|
| Business Entity | `src/domain/entities/` | `User.ts` |
| Use Case | `src/application/use-cases/` | `CreateUserUseCase.ts` |
| DTO | `src/application/dtos/` | `CreateUserDTO.ts` |
| Repository Interface | `src/domain/interfaces/repositories/` | `IUserRepository.ts` |
| Repository Implementation | `src/infrastructure/adapters/database/` | `UserRepository.ts` |
| Service Interface | `src/domain/interfaces/services/` | `IAIModelService.ts` |
| Service Implementation | `src/infrastructure/adapters/` | `GeminiAIModel.ts` |
| Server Action | `src/presentation/actions/[domain]/` | `actions.ts` |
| API Handler | `src/presentation/handlers/[domain]/` | `UserHandler.ts` |
| Next.js Route | `src/app/api/[resource]/` | `route.ts` (3-5 lines only) |
| Page Component | `src/app/(pages)/[page]/` | `page.tsx` |

### Available Tools
- **GCP gcloud CLI**: Cloud Run deployments, GCP operations
- **Terraform**: Infrastructure as code
- **Docker CLI**: Containerization
- **GitHub CLI (gh)**: PR management, repository operations

### Server Actions vs API Routes Decision Matrix

| Scenario | Pattern | Location |
|----------|---------|----------|
| Form submission | âœ… Server Action | `src/presentation/actions/` |
| Data mutation | âœ… Server Action | `src/presentation/actions/` |
| Page data fetching | âœ… Server Action | `src/presentation/actions/` |
| User interactions | âœ… Server Action | `src/presentation/actions/` |
| External API | âœ… API Route | `src/app/api/` + handlers |
| Webhook | âœ… API Route | `src/app/api/` + handlers |
| Mobile backend | âœ… API Route | `src/app/api/` + handlers |
| Third-party integration | âœ… API Route | `src/app/api/` + handlers |

**Default:** Always start with Server Action unless external consumer requires API.

---

## ğŸ¯ Rules

### Rule 1: Application Lifecycle Hooks
- Use hooks for startup and shutdown logic
- `appStartHook`: Initialize services, validate configuration
- `appEndHook`: Graceful shutdown and cleanup
- Always log key lifecycle events

---

## ğŸ¯ Quick Reference Checklist
When creating new features:
1. âœ… Define Domain entity in `src/domain/entities/`
2. âœ… Define Repository interface in `src/domain/interfaces/repositories/`
3. âœ… Implement Repository in `src/infrastructure/adapters/database/`
4. âœ… Create Use Case in `src/application/use-cases/`
5. âœ… Create DTOs in `src/application/dtos/`
6. âœ… Create Server Action in `src/presentation/actions/[domain]/`
7. âœ… Add UUID comments to all code blocks
8. âœ… Log to development history
9. âœ… Write tests

---

## ğŸš¨ Golden Rules
1. **Document Everything** â€“ Each module must explain itself
2. **Keep Code Simple** â€“ Readable and maintainable over clever
3. **Follow SRP** â€“ One function, one responsibility
4. **Track All Changes** â€“ Use UUID-based development history logging
5. **Validate Quality** â€“ Linter and test checks required before completion
6. **Use Correct Structure** â€“ Organized by Clean Architecture layers
7. **End Every Task with Documentation and Logging** â€“ This is mandatory
